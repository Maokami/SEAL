\doxysection{ckks.\+h}
\hypertarget{ckks_8h_source}{}\label{ckks_8h_source}\index{seal/ckks.h@{seal/ckks.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ Microsoft\ Corporation.\ All\ rights\ reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Licensed\ under\ the\ MIT\ license.}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}seal/context.h"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}seal/plaintext.h"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}seal/util/common.h"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}seal/util/croots.h"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}seal/util/defines.h"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}seal/util/dwthandler.h"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}seal/util/uintarithsmallmod.h"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}seal/util/uintcore.h"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <complex>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#ifdef\ SEAL\_USE\_MSGSL}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}gsl/span"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{namespace\ }seal}
\DoxyCodeLine{00024\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T\_out,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T\_out>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T\_out>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00029\ \ \ \ \ SEAL\_NODISCARD\ \textcolor{keyword}{inline}\ T\_out\ from\_complex(std::complex<double>\ in);}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00032\ \ \ \ \ SEAL\_NODISCARD\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{double}\ from\_complex(std::complex<double>\ in)}
\DoxyCodeLine{00033\ \ \ \ \ \{}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ in.real();}
\DoxyCodeLine{00035\ \ \ \ \ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00038\ \ \ \ \ SEAL\_NODISCARD\ \textcolor{keyword}{inline}\ std::complex<double>\ from\_complex(std::complex<double>\ in)}
\DoxyCodeLine{00039\ \ \ \ \ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ in;}
\DoxyCodeLine{00041\ \ \ \ \ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{namespace\ }util}
\DoxyCodeLine{00044\ \ \ \ \ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classseal_1_1util_1_1_arithmetic}{Arithmetic}}<\mbox{\hyperlink{namespacestd}{std}}::complex<double>,\ std::complex<double>,\ double>}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1util_1_1_arithmetic}{Arithmetic}}()}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \{\}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ std::complex<double>\ add(\textcolor{keyword}{const}\ std::complex<double>\ \&a,\ \textcolor{keyword}{const}\ std::complex<double>\ \&b)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00053\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ a\ +\ b;}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ std::complex<double>\ sub(\textcolor{keyword}{const}\ std::complex<double>\ \&a,\ \textcolor{keyword}{const}\ std::complex<double>\ \&b)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00058\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ a\ -\/\ b;}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ std::complex<double>\ mul\_root(\textcolor{keyword}{const}\ std::complex<double>\ \&a,\ \textcolor{keyword}{const}\ std::complex<double>\ \&r)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00063\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ a\ *\ r;}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ std::complex<double>\ mul\_scalar(\textcolor{keyword}{const}\ std::complex<double>\ \&a,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ \&s)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00068\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ a\ *\ s;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ std::complex<double>\ mul\_root\_scalar(\textcolor{keyword}{const}\ std::complex<double>\ \&r,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ \&s)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00073\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ r\ *\ s;}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ std::complex<double>\ guard(\textcolor{keyword}{const}\ std::complex<double>\ \&a)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00078\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ a;}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00082\ \ \ \ \ \}\ \textcolor{comment}{//\ namespace\ util}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder}{CKKSEncoder}}}
\DoxyCodeLine{00107\ \ \ \ \ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classseal_1_1util_1_1_arithmetic_3_01std_1_1complex_3_01double_01_4_00_01std_1_1complex_3_01double_01_4_00_01double_01_4}{ComplexArith}}\ =\ \mbox{\hyperlink{classseal_1_1util_1_1_arithmetic}{util::Arithmetic<std::complex<double>}},\ std::complex<double>,\ \textcolor{keywordtype}{double}>;}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classseal_1_1util_1_1_d_w_t_handler}{FFTHandler}}\ =\ \mbox{\hyperlink{classseal_1_1util_1_1_d_w_t_handler}{util::DWTHandler<std::complex<double>}},\ std::complex<double>,\ \textcolor{keywordtype}{double}>;}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder}{CKKSEncoder}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classseal_1_1_s_e_a_l_context}{SEALContext}}\ \&context);}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a71758c23292bee1f5056c87f02443c30}{encode}}(}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<T>\ \&values,\ parms\_id\_type\ parms\_id,\ \textcolor{keywordtype}{double}\ scale,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination,}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00151\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ encode\_internal(values.data(),\ values.size(),\ parms\_id,\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_ae94782e19c22991b95e640067cf4e646}{encode}}(}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<T>\ \&values,\ \textcolor{keywordtype}{double}\ scale,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination,}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00182\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a71758c23292bee1f5056c87f02443c30}{encode}}(values,\ context\_.\mbox{\hyperlink{classseal_1_1_s_e_a_l_context_a292e9ef4bca3931ce0eda85a6c434eb4}{first\_parms\_id}}(),\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00185\ \textcolor{preprocessor}{\#ifdef\ SEAL\_USE\_MSGSL}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a71758c23292bee1f5056c87f02443c30}{encode}}(}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ gsl::span<const\ T>\ values,\ parms\_id\_type\ parms\_id,\ \textcolor{keywordtype}{double}\ scale,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination,}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00216\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ encode\_internal(}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ values.data(),\ \textcolor{keyword}{static\_cast<}std::size\_t\textcolor{keyword}{>}(values.size()),\ parms\_id,\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a71758c23292bee1f5056c87f02443c30}{encode}}(}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ gsl::span<const\ T>\ values,\ \textcolor{keywordtype}{double}\ scale,\ Plaintext\ \&destination,}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ MemoryPoolHandle\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00248\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a71758c23292bee1f5056c87f02443c30}{encode}}(values,\ context\_.\mbox{\hyperlink{classseal_1_1_s_e_a_l_context_a292e9ef4bca3931ce0eda85a6c434eb4}{first\_parms\_id}}(),\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00251\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a24b555818b36dcb44fa58217d764a871}{encode}}(}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ value,\ parms\_id\_type\ parms\_id,\ \textcolor{keywordtype}{double}\ scale,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination,}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00275\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ encode\_internal(value,\ parms\_id,\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a980de83750fca2c983c6bca1b43657c6}{encode}}(}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ value,\ \textcolor{keywordtype}{double}\ scale,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination,\ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00298\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a71758c23292bee1f5056c87f02443c30}{encode}}(value,\ context\_.\mbox{\hyperlink{classseal_1_1_s_e_a_l_context_a292e9ef4bca3931ce0eda85a6c434eb4}{first\_parms\_id}}(),\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a64ff06c41def8626ed6d17a76a27add1}{encode}}(}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ std::complex<double>\ value,\ parms\_id\_type\ parms\_id,\ \textcolor{keywordtype}{double}\ scale,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination,}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00324\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ encode\_internal(value,\ parms\_id,\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_aaa61623d599b26770ad7fdea92aa3cfe}{encode}}(}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ std::complex<double>\ value,\ \textcolor{keywordtype}{double}\ scale,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination,}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00348\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a71758c23292bee1f5056c87f02443c30}{encode}}(value,\ context\_.\mbox{\hyperlink{classseal_1_1_s_e_a_l_context_a292e9ef4bca3931ce0eda85a6c434eb4}{first\_parms\_id}}(),\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a560dd9d10a58fed04ac259e3e22c56fc}{encode}}(std::int64\_t\ value,\ parms\_id\_type\ parms\_id,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00364\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ encode\_internal(value,\ parms\_id,\ destination);}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a047ea623797b251386ae9fe0c6220491}{encode}}(std::int64\_t\ value,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00378\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a71758c23292bee1f5056c87f02443c30}{encode}}(value,\ context\_.\mbox{\hyperlink{classseal_1_1_s_e_a_l_context_a292e9ef4bca3931ce0eda85a6c434eb4}{first\_parms\_id}}(),\ destination);}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a8f43d6391f41d65b22cf68677442785e}{decode}}(}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&plain,\ std::vector<T>\ \&destination,\ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00402\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ destination.resize(slots\_);}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ decode\_internal(plain,\ destination.\mbox{\hyperlink{classseal_1_1_plaintext_a3cc008a7387da45f5035d12fbb67936c}{data}}(),\ std::move(pool));}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00406\ \textcolor{preprocessor}{\#ifdef\ SEAL\_USE\_MSGSL}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a8f43d6391f41d65b22cf68677442785e}{decode}}(}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&plain,\ gsl::span<T>\ destination,\ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool\ =\ MemoryManager::GetPool())\textcolor{keyword}{\ const}}
\DoxyCodeLine{00427\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (destination.size()\ !=\ slots\_)}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}destination\ has\ invalid\ size"{}});}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ decode\_internal(plain,\ destination.data(),\ std::move(pool));}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00434\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ SEAL\_NODISCARD\ \textcolor{keyword}{inline}\ std::size\_t\ \mbox{\hyperlink{classseal_1_1_c_k_k_s_encoder_a324bf43b23f2869bad124a891ae67871}{slot\_count}}()\ const\ noexcept}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ slots\_;}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ encode\_internal(}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ T\ *values,\ std::size\_t\ values\_size,\ parms\_id\_type\ parms\_id,\ \textcolor{keywordtype}{double}\ scale,\ \mbox{\hyperlink{classseal_1_1_plaintext}{Plaintext}}\ \&destination,}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classseal_1_1_memory_pool_handle}{MemoryPoolHandle}}\ pool)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00451\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verify\ parameters.}}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ context\_data\_ptr\ =\ context\_.\mbox{\hyperlink{classseal_1_1_s_e_a_l_context_a177197adcfad21b54c7b11fda845d42c}{get\_context\_data}}(parms\_id);}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!context\_data\_ptr)}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}parms\_id\ is\ not\ valid\ for\ encryption\ parameters"{}});}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!values\ \&\&\ values\_size\ >\ 0)}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}values\ cannot\ be\ null"{}});}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (values\_size\ >\ slots\_)}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}values\_size\ is\ too\ large"{}});}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!pool)}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}pool\ is\ uninitialized"{}});}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&context\_data\ =\ *context\_data\_ptr;}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&parms\ =\ context\_data.parms();}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&coeff\_modulus\ =\ parms.coeff\_modulus();}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ coeff\_modulus\_size\ =\ coeff\_modulus.size();}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ coeff\_count\ =\ parms.poly\_modulus\_degree();}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Quick\ sanity\ check}}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!util::product\_fits\_in(coeff\_modulus\_size,\ coeff\_count))}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::logic\_error(\textcolor{stringliteral}{"{}invalid\ parameters"{}});}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ that\ scale\ is\ positive\ and\ not\ too\ large}}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (scale\ <=\ 0\ ||\ (\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(log2(scale))\ +\ 1\ >=\ context\_data.total\_coeff\_modulus\_bit\_count()))}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}scale\ out\ of\ bounds"{}});}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ ntt\_tables\ =\ context\_data.small\_ntt\_tables();}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ values\_size\ is\ guaranteed\ to\ be\ no\ bigger\ than\ slots\_}}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ n\ =\ util::mul\_safe(slots\_,\ std::size\_t(2));}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ conj\_values\ =\ util::allocate<std::complex<double>>(n,\ pool,\ 0);}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ values\_size;\ i++)}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ conj\_values[matrix\_reps\_index\_map\_[i]]\ =\ values[i];}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ if\ values\ are\ real,\ the\ following\ values\ should\ be\ set\ to\ zero,\ and\ multiply\ results\ by\ 2.}}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ conj\_values[matrix\_reps\_index\_map\_[i\ +\ slots\_]]\ =\ std::conj(values[i]);}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ fix\ =\ scale\ /\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(n);}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ fft\_handler\_.\mbox{\hyperlink{classseal_1_1util_1_1_d_w_t_handler_a5313d7bdfce1fc0b8750951a877a9a7e}{transform\_from\_rev}}(conj\_values.get(),\ util::get\_power\_of\_two(n),\ inv\_root\_powers\_.get(),\ \&fix);}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ max\_coeff\ =\ 0;}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ n;\ i++)}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_coeff\ =\ std::max<>(max\_coeff,\ std::fabs(conj\_values[i].real()));}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verify\ that\ the\ values\ are\ not\ too\ large\ to\ fit\ in\ coeff\_modulus}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note\ that\ we\ have\ an\ extra\ +\ 1\ for\ the\ sign\ bit}}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ compute\ logarithmis\ of\ numbers\ less\ than\ 1}}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ max\_coeff\_bit\_count\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(std::ceil(std::log2(std::max<>(max\_coeff,\ 1.0))))\ +\ 1;}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (max\_coeff\_bit\_count\ >=\ context\_data.total\_coeff\_modulus\_bit\_count())}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}encoded\ values\ are\ too\ large"{}});}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ two\_pow\_64\ =\ std::pow(2.0,\ 64);}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Resize\ destination\ to\ appropriate\ size}}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Need\ to\ first\ set\ parms\_id\ to\ zero,\ otherwise\ resize}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ will\ throw\ an\ exception.}}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \ \ destination.\mbox{\hyperlink{classseal_1_1_plaintext_af643a3b656727d350ed3206ea65adf40}{parms\_id}}()\ =\ parms\_id\_zero;}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ destination.\mbox{\hyperlink{classseal_1_1_plaintext_af10c6e3e01730199d2cddfdca480e039}{resize}}(util::mul\_safe(coeff\_count,\ coeff\_modulus\_size));}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Use\ faster\ decomposition\ methods\ when\ possible}}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (max\_coeff\_bit\_count\ <=\ 64)}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ n;\ i++)}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ coeffd\ =\ std::round(conj\_values[i].real());}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_negative\ =\ std::signbit(coeffd);}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::uint64\_t\ coeffu\ =\ \textcolor{keyword}{static\_cast<}std::uint64\_t\textcolor{keyword}{>}(std::fabs(coeffd));}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_negative)}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ j\ =\ 0;\ j\ <\ coeff\_modulus\_size;\ j++)}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destination[i\ +\ (j\ *\ coeff\_count)]\ =\ util::negate\_uint\_mod(}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ util::barrett\_reduce\_64(coeffu,\ coeff\_modulus[j]),\ coeff\_modulus[j]);}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ j\ =\ 0;\ j\ <\ coeff\_modulus\_size;\ j++)}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destination[i\ +\ (j\ *\ coeff\_count)]\ =\ util::barrett\_reduce\_64(coeffu,\ coeff\_modulus[j]);}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (max\_coeff\_bit\_count\ <=\ 128)}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ n;\ i++)}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ coeffd\ =\ std::round(conj\_values[i].real());}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_negative\ =\ std::signbit(coeffd);}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ coeffd\ =\ std::fabs(coeffd);}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::uint64\_t\ coeffu[2]\{\ \textcolor{keyword}{static\_cast<}std::uint64\_t\textcolor{keyword}{>}(std::fmod(coeffd,\ two\_pow\_64)),}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}std::uint64\_t\textcolor{keyword}{>}(coeffd\ /\ two\_pow\_64)\ \};}
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_negative)}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ j\ =\ 0;\ j\ <\ coeff\_modulus\_size;\ j++)}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destination[i\ +\ (j\ *\ coeff\_count)]\ =\ util::negate\_uint\_mod(}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ util::barrett\_reduce\_128(coeffu,\ coeff\_modulus[j]),\ coeff\_modulus[j]);}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ j\ =\ 0;\ j\ <\ coeff\_modulus\_size;\ j++)}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destination[i\ +\ (j\ *\ coeff\_count)]\ =\ util::barrett\_reduce\_128(coeffu,\ coeff\_modulus[j]);}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Slow\ case}}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ coeffu(util::allocate\_uint(coeff\_modulus\_size,\ pool));}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ n;\ i++)}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ coeffd\ =\ std::round(conj\_values[i].real());}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_negative\ =\ std::signbit(coeffd);}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ coeffd\ =\ std::fabs(coeffd);}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ are\ at\ this\ point\ guaranteed\ to\ fit\ in\ the\ allocated\ space}}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ util::set\_zero\_uint(coeff\_modulus\_size,\ coeffu.get());}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ coeffu\_ptr\ =\ coeffu.get();}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (coeffd\ >=\ 1)}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *coeffu\_ptr++\ =\ \textcolor{keyword}{static\_cast<}std::uint64\_t\textcolor{keyword}{>}(std::fmod(coeffd,\ two\_pow\_64));}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ coeffd\ /=\ two\_pow\_64;}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Next\ decompose\ this\ coefficient}}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ context\_data.rns\_tool()-\/>base\_q()-\/>decompose(coeffu.get(),\ pool);}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Finally\ replace\ the\ sign\ if\ necessary}}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_negative)}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ j\ =\ 0;\ j\ <\ coeff\_modulus\_size;\ j++)}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destination[i\ +\ (j\ *\ coeff\_count)]\ =\ util::negate\_uint\_mod(coeffu[j],\ coeff\_modulus[j]);}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ j\ =\ 0;\ j\ <\ coeff\_modulus\_size;\ j++)}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destination[i\ +\ (j\ *\ coeff\_count)]\ =\ coeffu[j];}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00620\ }
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transform\ to\ NTT\ domain}}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ coeff\_modulus\_size;\ i++)}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ util::ntt\_negacyclic\_harvey(destination.\mbox{\hyperlink{classseal_1_1_plaintext_a3cc008a7387da45f5035d12fbb67936c}{data}}(i\ *\ coeff\_count),\ ntt\_tables[i]);}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \ \ destination.\mbox{\hyperlink{classseal_1_1_plaintext_af643a3b656727d350ed3206ea65adf40}{parms\_id}}()\ =\ parms\_id;}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \ \ \ \ destination.\mbox{\hyperlink{classseal_1_1_plaintext_a958fcd7c2bb3b1efc8bc8ccb1c6dc575}{scale}}()\ =\ scale;}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00630\ }
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ \textcolor{keywordtype}{double}>::value\ ||}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_same<std::remove\_cv\_t<T>,\ std::complex<double>>::value>>}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ decode\_internal(\textcolor{keyword}{const}\ Plaintext\ \&plain,\ T\ *destination,\ MemoryPoolHandle\ pool)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00636\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verify\ parameters.}}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!is\_valid\_for(plain,\ context\_))}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}plain\ is\ not\ valid\ for\ encryption\ parameters"{}});}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!plain.is\_ntt\_form())}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}plain\ is\ not\ in\ NTT\ form"{}});}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!destination)}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}destination\ cannot\ be\ null"{}});}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!pool)}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}pool\ is\ uninitialized"{}});}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&context\_data\ =\ *context\_.\mbox{\hyperlink{classseal_1_1_s_e_a_l_context_a177197adcfad21b54c7b11fda845d42c}{get\_context\_data}}(plain.parms\_id());}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&parms\ =\ context\_data.parms();}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ coeff\_modulus\_size\ =\ parms.coeff\_modulus().size();}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ coeff\_count\ =\ parms.poly\_modulus\_degree();}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ rns\_poly\_uint64\_count\ =\ util::mul\_safe(coeff\_count,\ coeff\_modulus\_size);}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ ntt\_tables\ =\ context\_data.small\_ntt\_tables();}
\DoxyCodeLine{00662\ }
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ that\ scale\ is\ positive\ and\ not\ too\ large}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (plain.scale()\ <=\ 0\ ||}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(log2(plain.scale()))\ >=\ context\_data.total\_coeff\_modulus\_bit\_count()))}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::invalid\_argument(\textcolor{stringliteral}{"{}scale\ out\ of\ bounds"{}});}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00669\ }
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ decryption\_modulus\ =\ context\_data.total\_coeff\_modulus();}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ upper\_half\_threshold\ =\ context\_data.upper\_half\_threshold();}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ logn\ =\ util::get\_power\_of\_two(coeff\_count);}
\DoxyCodeLine{00673\ }
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Quick\ sanity\ check}}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((logn\ <\ 0)\ ||\ (coeff\_count\ <\ SEAL\_POLY\_MOD\_DEGREE\_MIN)\ ||\ (coeff\_count\ >\ SEAL\_POLY\_MOD\_DEGREE\_MAX))}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::logic\_error(\textcolor{stringliteral}{"{}invalid\ parameters"{}});}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00679\ }
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ inv\_scale\ =\ double(1.0)\ /\ plain.scale();}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ mutable\ copy\ of\ input}}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ plain\_copy(util::allocate\_uint(rns\_poly\_uint64\_count,\ pool));}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ util::set\_uint(plain.data(),\ rns\_poly\_uint64\_count,\ plain\_copy.get());}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transform\ each\ polynomial\ from\ NTT\ domain}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ coeff\_modulus\_size;\ i++)}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ util::inverse\_ntt\_negacyclic\_harvey(plain\_copy.get()\ +\ (i\ *\ coeff\_count),\ ntt\_tables[i]);}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CRT-\/compose\ the\ polynomial}}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ \ \ context\_data.rns\_tool()-\/>base\_q()-\/>compose\_array(plain\_copy.get(),\ coeff\_count,\ pool);}
\DoxyCodeLine{00694\ }
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ floating-\/point\ representations\ of\ the\ multi-\/precision\ integer\ coefficients}}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ two\_pow\_64\ =\ std::pow(2.0,\ 64);}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ res(util::allocate<std::complex<double>>(coeff\_count,\ pool));}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ coeff\_count;\ i++)}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res[i]\ =\ 0.0;}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (util::is\_greater\_than\_or\_equal\_uint(}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ plain\_copy.get()\ +\ (i\ *\ coeff\_modulus\_size),\ upper\_half\_threshold,\ coeff\_modulus\_size))}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ scaled\_two\_pow\_64\ =\ inv\_scale;}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ j\ =\ 0;\ j\ <\ coeff\_modulus\_size;\ j++,\ scaled\_two\_pow\_64\ *=\ two\_pow\_64)}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (plain\_copy[i\ *\ coeff\_modulus\_size\ +\ j]\ >\ decryption\_modulus[j])}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ diff\ =\ plain\_copy[i\ *\ coeff\_modulus\_size\ +\ j]\ -\/\ decryption\_modulus[j];}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res[i]\ +=\ diff\ ?\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(diff)\ *\ scaled\_two\_pow\_64\ :\ 0.0;}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ diff\ =\ decryption\_modulus[j]\ -\/\ plain\_copy[i\ *\ coeff\_modulus\_size\ +\ j];}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res[i]\ -\/=\ diff\ ?\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(diff)\ *\ scaled\_two\_pow\_64\ :\ 0.0;}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ scaled\_two\_pow\_64\ =\ inv\_scale;}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ j\ =\ 0;\ j\ <\ coeff\_modulus\_size;\ j++,\ scaled\_two\_pow\_64\ *=\ two\_pow\_64)}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ curr\_coeff\ =\ plain\_copy[i\ *\ coeff\_modulus\_size\ +\ j];}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res[i]\ +=\ curr\_coeff\ ?\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(curr\_coeff)\ *\ scaled\_two\_pow\_64\ :\ 0.0;}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00728\ }
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Scaling\ instead\ incorporated\ above;\ this\ can\ help\ in\ cases}}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ where\ otherwise\ pow(two\_pow\_64,\ j)\ would\ overflow\ due\ to\ very}}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ large\ coeff\_modulus\_size\ and\ very\ large\ scale}}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ res[i]\ =\ res\_accum\ *\ inv\_scale;}}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ fft\_handler\_.\mbox{\hyperlink{classseal_1_1util_1_1_d_w_t_handler_a0ff0f528d011ff99c1c0c1ba241d50db}{transform\_to\_rev}}(res.get(),\ logn,\ root\_powers\_.get());}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ i\ =\ 0;\ i\ <\ slots\_;\ i++)}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destination[i]\ =\ from\_complex<T>(res[\textcolor{keyword}{static\_cast<}std::size\_t\textcolor{keyword}{>}(matrix\_reps\_index\_map\_[i])]);}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ encode\_internal(}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ value,\ parms\_id\_type\ parms\_id,\ \textcolor{keywordtype}{double}\ scale,\ Plaintext\ \&destination,\ MemoryPoolHandle\ pool)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00745\ }
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ encode\_internal(}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ std::complex<double>\ value,\ parms\_id\_type\ parms\_id,\ \textcolor{keywordtype}{double}\ scale,\ Plaintext\ \&destination,}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \ \ \ \ MemoryPoolHandle\ pool)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00749\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ input\ =\ util::allocate<std::complex<double>>(slots\_,\ pool\_,\ value);}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ encode\_internal(input.get(),\ slots\_,\ parms\_id,\ scale,\ destination,\ std::move(pool));}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00753\ }
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ encode\_internal(std::int64\_t\ value,\ parms\_id\_type\ parms\_id,\ Plaintext\ \&destination)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ MemoryPoolHandle\ pool\_\ =\ MemoryManager::GetPool();}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ SEALContext\ context\_;}
\DoxyCodeLine{00759\ }
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ std::size\_t\ slots\_;}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ std::shared\_ptr<util::ComplexRoots>\ complex\_roots\_;}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Holds\ 1\string~(n-\/1)-\/th\ powers\ of\ root\ in\ bit-\/reversed\ order,\ the\ 0-\/th\ power\ is\ left\ unset.}}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ util::Pointer<std::complex<double>>\ root\_powers\_;}
\DoxyCodeLine{00766\ }
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Holds\ 1\string~(n-\/1)-\/th\ powers\ of\ inverse\ root\ in\ scrambled\ order,\ the\ 0-\/th\ power\ is\ left\ unset.}}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ util::Pointer<std::complex<double>>\ inv\_root\_powers\_;}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ util::Pointer<std::size\_t>\ matrix\_reps\_index\_map\_;}
\DoxyCodeLine{00771\ }
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ ComplexArith\ complex\_arith\_;}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ FFTHandler\ fft\_handler\_;}
\DoxyCodeLine{00775\ \ \ \ \ \};}
\DoxyCodeLine{00776\ \}\ \textcolor{comment}{//\ namespace\ seal}}

\end{DoxyCode}
